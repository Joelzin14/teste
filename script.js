if(navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1){var root=document.getElementsByTagName("html")[0];root.className+=" safari"};
Vue.use(VueResource);var avatar=new Vue({el:"#avatarApp",data:{intro:{start:1,last:1,current:null},StepMom:!1,storageId:"",storageMomId:"",config:null,isLoading:!1,isInitializing:!1,selectedCategory:null,selectedSubCategory:null,selectedGroup:null,selectedColor:null,customizations:[],showMissingCustomizations:!1,isAnimatingCategory:!1,isDraggingCategories:!1,characterCategoriesAssets:{},disableList:{},windowWidth:0,windowHeight:0,categoriesScrollTimeout:null,momArray:[],mainId:"",step2:!1,errors:[],zoomIn:!1,selectedCharacter:{},scaleFixer:1.3,scaleFixerMobile:1.1,customProperties:{},selectedCharacterType:{}},methods:{setSize:function(n,t){var i={characterId:n,typeId:t};this.momArray=i},setStorageSecondCharacter:function(n){var t=this;t.mainId=n?"ddh-builder-e-main-"+t.config.builderCharacterId+"-"+t.config.layoutId:"ddh-builder-a-main-"+t.config.builderProductId+"-"+t.config.layoutId},setStorageId:function(n){var t=this;t.storageId=n?"ddh-builder-e-"+t.config.builderCharacterId:"ddh-builder-a-"+t.config.builderProductId},getStorageItem:function(n,t){var i=window.builderStorage.getItem(t?"local":"session",n);return i?JSON.parse(i):null},updateStorageItem:function(n,t,i){window.builderStorage.setItem(i?"local":"session",n,JSON.stringify(t))},saveMomStorageItem:function(n,t,i){window.builderStorage.setItem(i?"local":"session",n,JSON.stringify(t))},removeStorageItem:function(n,t){window.builderStorage.removeItem(t?"local":"session",n)},removeStorageSecondCharacter:function(){var t=this,i=t.getStorageItem(t.mainId),n;i!=null&&i.step2&&(n=t.getStorageItem(t.storageId),n!=null&&n.character!=null&&(n.characterSecond=i.character,t.updateStorageItem(t.storageId,n),n.characterSecond&&this.setSize(n.characterSecond.character_id,n.characterSecond.id)))},loadModalSecondCharacter:function(){var t=this,n=t.getStorageItem(t.storageId);n!=null&&n.uuidSecondCharacter!=null&&($("#secondCharacterName").val(n.nameSecondCharacter),this.updateStorageItem("checkSecundAvatarIntro",!1,!0))},loadModalSecondCharacterEdit:function(){var t=this,n=t.getStorageItem(t.mainId),i=t.config.updatedShoppingCartItemId;n!=null&&n.uuidSecondCharacter!=null?($("#secondCharacterName").val(n.nameSecondCharacter),this.updateStorageItem("checkSecundAvatarIntro",!1,!0)):i>0&&(t.setStorageSecondCharacter(!1),n=t.getStorageItem(t.mainId),n!=null&&n.step2&&(n.gender=="Menina2"||n.gender=="Menina")&&($("#secondCharacterName").val(n.properties[0].value),this.updateStorageItem("checkSecundAvatarIntro",!1,!0),n.character&&this.setSize(n.character.character_id,n.character.id)),t.setStorageSecondCharacter(!0))},loadSecondCharacter:function(n){var t=this,r=t.getStorageItem(t.mainId),u=t.getStorageItem(t.storageId),f=t.config.updatedShoppingCartItemId,i;u!=null&&u.uuidSecondCharacter!=null?(t.loadCharacter(u.uuidSecondCharacter,n),this.updateStorageItem("checkSecundAvatarIntro",!0,!0)):r!=null&&r.uuidSecondCharacter!=null?r.characterSecoundOld!=null&&r.characterSecond.id==r.characterSecoundOld.id?(t.loadCharacter(r.uuidSecondCharacter,n),this.updateStorageItem("checkSecundAvatarIntro",!0,!0),$("#secondCharacterName").val(r.nameSecondCharacter)):(u.customizations=null,t.updateStorageItem(t.storageId,u)):f>0&&(t.setStorageSecondCharacter(!1),i=t.getStorageItem(t.mainId),i!=null&&i.step2&&(i.gender=="Menina2"||i.gender=="Menina")&&(this.updateStorageItem("checkSecundAvatarIntro",!0,!0),i=t.getStorageItem(t.storageId),i.properties[0].value=u.properties[0].value,i.step2=!0,t.updateStorageItem(t.storageId,i)),t.setStorageSecondCharacter(!0))},UpdateBeforeLoadSecondCharacter:function(){var n=this,r=n.getStorageItem(n.mainId),t,i;r!=null&&r.nameSecondCharacter!=null&&(t=n.getStorageItem(n.storageId),t.properties[0].product_id="1482",t.properties[1].product_id="1482",t.properties[0].value=r.nameSecondCharacter,i={},i.properties=t.properties,i.character=t.character,i.step2=!0,n.updateStorageItem(n.storageId,i))},init:function(){function u(n){const i=`; ${document.cookie}`,t=i.split(`; ${n}=`);if(t.length===2)return t.pop().split(";").shift()}function f(){var n=setInterval(function(){$(".btn-previous")&&$(".btn-previous").length>0&&($(".btn-previous").attr("href",window.config.previousUrl),clearInterval(n))},500)}function t(){var t,s,h,r,i,e,c;const o=u("ddh-whitelabel-"+config.builderProductId);if(o){const t=JSON.parse(o);window.config.previousUrl=t.previousUrl;n.updateStorageItem(n.storageId,t);document.cookie=`ddh-whitelabel-${config.builderProductId}=; domain=.dentrodahistoria.com.br; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Lax; Secure`;console.log("Avatar com cookie aprovado");f()}for(t=n.getStorageItem(n.storageId),t?(s=t.character.id,h=t.character.character_id):location.href=n.config.previousUrl,r={},i=0;i<t.properties.length;i++)r[t.properties[i].code]={property_id:t.properties[i].property_id,value:t.properties[i].value};(n.customProperties=r,n.checkStep(t))&&(e="",t!=null&&t.character!=null&&t.character.language!=null&&(e="&language="+t.character.language.slug,n.config.language=t.character.language,t.character.languages!=null&&(n.config.languages=t.character.languages)),c=n.config.api+"/api/characters/"+h+"/categories/assets/treelist?character_type_id="+s+"&product_id="+n.config.builderProductId+e,n.$http.get(c).then(function(t){n.characterCategoriesAssets=t.data.character_categories_assets[0];n.selectedCharacter=t.data.character_categories_assets[0].character;n.selectedCharacterType=t.data.character_categories_assets[0].type;for(var i=0;i<n.characterCategoriesAssets.categories.length;i++)n.characterCategoriesAssets.categories[i].active=!0;n.prepareCharacterCategoriesAssets(function(){var i,t,r;n.isInitializing=!1;for(i in n.customizations)for(t in n.characterCategoriesAssets.categories)if(n.customizations[i].categoryId===n.characterCategoriesAssets.categories[t].id){for(r in n.characterCategoriesAssets.categories[t].assets.subcategories)if(n.customizations[i].subcategoryId===n.characterCategoriesAssets.categories[t].assets.subcategories[r].id){n.disableCategory(n.characterCategoriesAssets.categories[t].assets.subcategories[r]);break}break}n.selectCategory(n.characterConfiguration.categories[0]);n.getStorageItem("checkAvatarIntro",!0)||n.introStep()})},function(){console.log("Show some error to the user in the interface")}))}var n=this,r,i;n.config=window.config;n.isInitializing=!0;n.initModals();n.config.builderCharacterId?(n.setStorageId(!0),n.setStorageSecondCharacter(!0),r=n.getStorageItem(n.storageId),r&&r.customizations?t():(i=n.getStorageItem(n.mainId),i&&i.uuid?i.step2?n.loadCharacter(i.uuid,t):(n.getStorageItem("checkSecundAvatarIntro",!0)||n.loadSecondCharacter(t),t()):n.loadCharacter(n.config.builderCharacterId,t))):(n.setStorageSecondCharacter(!1),n.setStorageId(!1),n.removeStorageSecondCharacter(),i=n.getStorageItem(n.mainId),t(),n.getStorageItem("checkSecundAvatarIntro",!0)||n.loadSecondCharacter(t))},introStep:function(){this.intro.current=this.intro.start},checkStep:function(n){var i=this,t=n&&n.properties&&n.properties.length>0;return t||(location.href=this.config.previousUrl),t},loadCharacter:function(n,t){var i=this,r=i.config.api+"/api/customs_characters/"+n+"?full_data=1";i.$http.get(r).then(function(r){var c=[],e,o,h,u,f,s;if(r.data.custom&&r.data.custom.user_data&&r.data.custom.user_data.properties)for(e in r.data.custom.user_data.properties)c.push({property_id:r.data.custom.user_data.properties[e].property_id,value:r.data.custom.user_data.properties[e].value,code:e});o={};r.data.custom&&(r.data.custom.user_data&&(o.id=r.data.custom.user_data.type),o.character_id=r.data.custom.character_id);r.data.layout_id&&(config.layoutId=r.data.layout_id);h=i.getStorageItem(i.setStorageId);u={};u.customizations=null;u.uuid=n;u.properties=h?h.properties:c;u.character=o;f=i.getStorageItem(i.storageId);s=i.getStorageItem(i.mainId);s!=null&&f!=null&&f.summary==null&&(u.step2=!0,u.customizations=s.customizations,i.updateStorageItem(i.storageId,u));(f==null||f.step2)&&(f!=null||s!=null)||i.updateStorageItem(i.storageId,u);t()},function(){console.log("Show some error to the user in the interface");i.setStorageId(!1);t()})},initModals:function(){$(".modal").on("shown.bs.modal",function(){$("body").addClass("modal-opened");window.scrollTo(0,0)}).on("hide.bs.modal",function(){window.scrollTo(0,0);$("body").removeClass("modal-opened")})},nextStep:function(){var n=this,e,f,o,u,t;if(!n.isLoading)if(n.isLoading=!0,n.validateStep()){var s=n.config.api+"/api/customs_characters/",i={},r=n.getStorageItem(n.storageId);for(i.character_id=r.character.character_id,i.type_id=r.character.id,i.product_id=n.config.builderProductId,n.config.layoutId&&(i.layout_id=n.config.layoutId),n.config.language!=null&&n.config.language.slug&&(i.language=n.config.language.slug),e=[],t=0;t<n.customizations.length;t++)f={parent_id:n.customizations[t].categoryId,id:n.customizations[t].colorId?n.customizations[t].colorId:n.customizations[t].subcategoryId},f.parent_id&&f.id&&e.push(f);for(i.categories=e,o={},u=0;u<r.properties.length;u++)o[r.properties[u].code]={property_id:r.properties[u].property_id,value:r.properties[u].value};i.user_data={properties:o,type:r.character.id};n.$http.post(s,{custom_character:i},{headers:{"Content-Type":"application/json"}}).then(function(t){var r=t.body.custom.uuid,i=n.config.updatedShoppingCartItemId,u=t.data.custom.summary;i>0?n.$http.post("/api/v1/shoppingcart/edit/builder/custom_character",{uuid:r,shoppingCartItemId:i,summary:u},{headers:{"Content-Type":"application/json"}}).then(function(i){i.body.success?(n.saveLocalHistorage(t.data.custom.uuid,t.data.custom.summary,t.data.custom.gender,t.data.custom.layout_id),location.href=n.config.nextUrl):(console.log(t),n.isLoading=!1)},function(t){console.log(t);n.isLoading=!1}):(n.saveLocalHistorage(t.data.custom.uuid,t.data.custom.summary,t.data.custom.gender,t.data.custom.layout_id),location.href=n.config.nextUrl)},function(t){console.log(t);n.isLoading=!1})}else{for(t=0;t<n.characterConfiguration.categories.length;t++)if(n.getValidateCategories[0].id==n.characterConfiguration.categories[t].id){n.selectCategory(n.characterConfiguration.categories[t]);break}n.showMissingCustomizations=!0;n.isLoading=!1}},nextStepMain:function(){var n=this,o,e,s,f,i;if(!n.isLoading)if(n.isLoading=!0,n.validateStep()){var h=n.config.api+"/api/customs_characters/",u={},t=n.getStorageItem(n.storageId),r=n.getStorageItem(n.mainId);for(u.product_id=t&&t.step2?"1482":n.config.builderProductId,u.character_id=t.character.character_id,u.type_id=t.character.id,n.config.layoutId&&(u.layout_id=n.config.layoutId),n.config.language!=null&&n.config.language.slug&&(u.language=n.config.language.slug),o=[],i=0;i<n.customizations.length;i++)e={parent_id:n.customizations[i].categoryId,id:n.customizations[i].colorId?n.customizations[i].colorId:n.customizations[i].subcategoryId},e.parent_id&&e.id&&o.push(e);for(u.categories=o,s={},f=0;f<t.properties.length;f++)s[t.properties[f].code]={property_id:t.properties[f].property_id,value:t.properties[f].value};u.user_data={properties:s,type:t.character.id};n.$http.post(h,{custom_character:u},{headers:{"Content-Type":"application/json"}}).then(function(i){var e=i.body.custom.uuid,s=n.config.updatedShoppingCartItemId,a=i.data.custom.summary,u;if(s>0)if(t&&t.step2){n.setStorageSecondCharacter(!0);var f=n.getStorageItem(n.mainId),o=f.uuid,h=f.summary,c=f.gender,l=f.layout_id;n.setStorageSecondCharacter(!0);n.$http.post("/api/v1/shoppingcart/edit/builder/custom_character",{uuid:o,shoppingCartItemId:s,summary:h},{headers:{"Content-Type":"application/json"}}).then(function(i){i.body.success&&(n.saveLocalHistorageMain(o,h,c,l),r.nameSecondCharacter=t.properties[0].value,t=r,n.updateStorageItem(n.storageId,t),n.associateSecondCharacter(o,e))},function(t){console.log(t);n.isLoading=!1})}else n.saveLocalHistorageMain(i.data.custom.uuid,i.data.custom.summary,i.data.custom.gender,i.data.custom.layout_id),$("#modalMom").modal(),n.loadModalSecondCharacterEdit(),this.updateStorageItem("checkSecundAvatarIntro",!1,!0),n.isLoading=!1;else t&&t.step2?(r!=null&&(r.nameSecondCharacter=t.properties[0].value,r.uuidSecondCharacter=e,t=r),n.saveLocalHistorageMain(i.data.custom.uuid,i.data.custom.summary,i.data.custom.gender,i.data.custom.layout_id),n.updateStorageItem(n.storageId,t),n.associateSecondCharacter(t.uuid,e),this.updateStorageItem("checkSecundAvatarIntro",!0,!0)):(r&&r.step2?(u=t,u.uuid=i.data.custom.uuid,u.summary=i.data.custom.summary,u.customizations=this.customizations,n.updateStorageItem(n.storageId,r),n.updateStorageItem(n.mainId,u),$("#modalMom").modal(),n.loadModalSecondCharacterEdit(),this.updateStorageItem("checkSecundAvatarIntro",!1,!0)):(n.saveLocalHistorageMain(i.data.custom.uuid,i.data.custom.summary,i.data.custom.gender,i.data.custom.layout_id),$("#modalMom").modal(),n.loadModalSecondCharacter(),this.updateStorageItem("checkSecundAvatarIntro",!1,!0)),n.isLoading=!1)},function(t){console.log(t);n.isLoading=!1})}else{for(i=0;i<n.characterConfiguration.categories.length;i++)if(n.getValidateCategories[0].id==n.characterConfiguration.categories[i].id){n.selectCategory(n.characterConfiguration.categories[i]);break}n.showMissingCustomizations=!0;n.isLoading=!1}},validateStep:function(){return this.getValidateCategories.length==0},associateSecondCharacter:function(n,t){var i=this,r=i.config.api+"/api/customs_characters/addExtraPersonagem/"+n;i.$http.post(r,{principal:n,adulto:t},{headers:{"Content-Type":"application/json"}}).then(function(n){n.errors?(console.log(n.errors),i.isLoading=!1):location.href=i.config.nextUrl})},saveMom:function(){var n=this,i=$("#secondCharacterName").val(),t,r,u;n.errors=[];i&&i!==null&&i.length<=12&&n.momArray.typeId&&n.momArray.characterId?(t=n.getStorageItem(n.storageId),r=n.getStorageItem(n.mainId),r!=null&&r.uuidSecondCharacter!=null?(r.characterSecoundOld=r.characterSecond,r.nameSecondCharacter=i,r.characterSecond={id:n.momArray.typeId,character_id:n.momArray.characterId},t.character={id:n.momArray.typeId,character_id:n.momArray.characterId},t.properties[0].value=i,n.updateStorageItem(n.storageId,t),n.updateStorageItem(n.mainId,r)):(n.removeStorageItem(n.storageId),t.properties[0].product_id="1482",t.properties[1].product_id="1482",t.character={id:n.momArray.typeId,character_id:n.momArray.characterId},t.properties[0].value=i,u={},u.properties=t.properties,u.character=t.character,u.step2=!0,n.updateStorageItem(n.storageId,u)),window.location.reload(!0)):(i.length>12?n.errors.push("nameLength"):(i==""||i.length==0)&&n.errors.push("name"),n.momArray.length==0&&n.errors.push("characters"))},saveLocalHistorage:function(n,t,i,r){var f=this,u=f.getStorageItem(f.storageId);u.customizations=this.customizations;u.uuid=n;u.gender=i;u.summary=t;u.layout_id=r;u.step2=!0;f.updateStorageItem(f.storageId,u)},saveLocalHistorageMain:function(n,t,i,r){var f=this,u=f.getStorageItem(f.storageId);u.customizations=this.customizations;u.uuid=n;u.gender=i;u.summary=t;u.layout_id=r;f.updateStorageItem(f.mainId,u)},prepareCharacterCategoriesAssets:function(n){function i(){var o,s,u,i,r,n,h,f,e;_.forEach(t.characterCategoriesAssets.categories,function(c){if(i=r=n=null,o=c.id,s=c.depends_category,h=c.z_index,c.depends_category){var l=t.getCustomization(c.depends_category);e=l?l.subcategoryId:"";_.forEach(c.assets.categories,function(t){if(t.parent_id==e)return _.forEach(t.assets.subcategories,function(t){if(t.is_default)if(u=t.id,t.z_index!=null&&t.z_index>=0&&(f=t.z_index),t.assets.colors.length>0){var e=_.filter(t.assets.colors,{is_default:!0});e.length>0?(i=e[0].id,r=e[0].hexa,n=e[0].assets.asset):(i=t.assets.colors[0].id,r=t.assets.colors[0].hexa,n=t.assets.colors[0].assets.asset)}else n=t.assets.asset}),!1})}else _.forEach(c.assets.subcategories,function(t){if(t.is_default)if(u=t.id,t.z_index!=null&&t.z_index>=0&&(f=t.z_index),t.assets.colors.length>0){var e=_.filter(t.assets.colors,{is_default:!0});e.length>0?(i=e[0].id,r=e[0].hexa,n=e[0].assets.asset):(i=t.assets.colors[0].id,r=t.assets.colors[0].hexa,n=t.assets.colors[0].assets.asset)}else n=t.assets.asset});n&&t.addCustomization(o,s,u,i,r,n,h,f)})}var t=this;t.characterCategoriesAssets.categories=_.sortBy(t.characterCategoriesAssets.categories,[function(n){return n.sort_order}]);_.forEach(t.characterCategoriesAssets.categories,function(n){n.depends_category?(_.forEach(t.characterCategoriesAssets.categories,function(t){if(t!=n)return n.depends_category==t.id?(t.relatedCategory=n,!1):void 0}),_.forEach(n.assets.categories,function(){n.assets.subcategories=_.sortBy(n.assets.subcategories,[function(n){n.sort_order}])})):n.assets.subcategories=_.sortBy(n.assets.subcategories,[function(n){n.sort_order}])});t.characterCategoriesAssets.groups=_.sortBy(this.characterCategoriesAssets.groups,[function(n){return n.sort_order}]);_.forEach(t.characterCategoriesAssets.groups,function(n){n.depends_category?_.forEach(n.assets.categories,function(){n.assets.subcategories=_.sortBy(n.assets.subcategories,[function(n){n.sort_order}])}):n.assets.subcategories=_.sortBy(n.assets.subcategories,[function(n){n.sort_order}])});t.restoreCustomization(n,i)},selectCategory:function(n){var t=this,i,r,u;if((!t.selectedCategory||t.selectedCategory.id!=n.id)&&n.active!==!1)t.zoomIn=!1,["oculos","olhos","cabelo"].includes(n.code)&&(t.zoomIn=!0),t.resetAnimation(),t.selectedGroup=null,t.selectedSubCategory=null,t.selectedColor=null,i=t.getCustomization(n.id),i?i.subcategoryId&&(n.depends_category?(u=t.getCustomization(n.depends_category),_.forEach(n.assets.categories,function(n){return _.forEach(n.assets.subcategories,function(t){if(n.parent_id==u.subcategoryId&&t.id==i.subcategoryId)return r=t,!1}),r?!1:void 0})):_.forEach(n.assets.subcategories,function(n){if(n.id==i.subcategoryId)return r=n,!1}),t.selectSubCategory(r,i)):t.addCustomization(n.id,n.depends_category,null,null,null,null,n.z_index),t.selectedCategory=n},selectGroup:function(n){var t=this;t.selectedGroup&&t.selectedGroup.id==n.id||(t.selectedCategory=null,t.selectedSubCategory=null,t.selectedColor=null,_.forEach(n.groupedCategories,function(i){var u=t.getCustomization(i),e,f,r;if(u&&u.subcategoryId)_.forEach(n.assets.subcategories,function(n){if(n.id==u.subcategoryId)return e=n,!1}),t.selectSubCategory(e,u);else{if(f=n.z_index,n.groupCategoriesAssortments)for(r=0;r<n.groupCategoriesAssortments.length;r++)if(n.groupCategoriesAssortments[r].category_id==i){f=n.groupCategoriesAssortments[r].z_index;break}t.addCustomization(i,null,null,null,null,null,f)}}),t.selectedGroup=n)},isSubCategoryRequired:function(n){var t=!1,i=this;return _.forEach(i.characterCategoriesAssets.categories,function(i){if(i.id==n.parent_id)return t=i.required,!1}),t},disableCategory:function(n){var t,r,u,i;if(n.disable!=undefined){if(t=this,t.disableList[n.parent_id]=n.disable,n.disable.length>0)for(r=0;r<n.disable.length;r++)for(u=n.disable[r],i=0;i<t.customizations.length;i++)t.customizations[i].categoryId==u&&t.customizations.splice(i,1);this.setDisable()}},setDisable:function(){for(var r,u,f,i,n=this,t=0;t<n.characterCategoriesAssets.categories.length;t++)n.characterCategoriesAssets.categories[t].active=!0;for(r in n.disableList)if(n.disableList[r]!==undefined)for(u=n.disableList[r],t=0;t<u.length;t++)for(f=u[t],i=0;i<n.characterCategoriesAssets.categories.length;i++)n.characterCategoriesAssets.categories[i].id==f&&(n.characterCategoriesAssets.categories[i].active=!1)},selectSubCategory:function(n,t){var u,r=this,i;if(this.disableCategory(n),this.selectedSubCategory&&this.selectedSubCategory.id==n.id){if(r.isSubCategoryRequired(n)==!1)for(this.selectedSubCategory=null,this.selectedColor=null,i=r.customizations.length-1;i>=0;i--)r.customizations[i].subcategoryId==n.id&&(r.customizations[i].subcategoryId=null,r.customizations[i].asset=n.assets.asset,r.customizations[i].colorId=null,r.customizations[i].colorHexa=null);return}this.selectedColor=null;t?t.subcategoryId=n.id:t=this.updateCustomization(n.parent_id,n.id);t.priorityZIndex=n.z_index!=null&&n.z_index>=0?n.z_index:null;n.assets.colors.length>0&&(t.colorId?_.forEach(n.assets.colors,function(n){if(n.hexa==t.colorHexa)return u=n,!1}):_.forEach(n.assets.colors,function(n){if(n.is_default)return u=n,!1}),u=u||n.assets.colors[0]);u?this.selectColor(u,t):(t.asset=n.assets.asset,t.colorId=null,t.colorHexa=null);this.updateRelatedCustomization(t);this.selectedSubCategory=n},selectColor:function(n,t){this.selectedColor&&this.selectColor.id==n.id||(t?n.id!=t.colorId&&(t.colorId=n.id,t.colorHexa=n.hexa,t.asset=n.assets.asset):this.updateCustomization(n.parent_id,null,n.id,n.hexa,n.assets.asset),this.selectedColor=n)},addCustomization:function(n,t,i,r,u,f,e,o){for(var s,c=!0,h=0;h<this.customizations.length;h++)if(s=this.customizations[h],s.categoryId==n){s.categoryId=n;s.relatedCategoryId=t;s.subcategoryId=i;s.colorId=r;s.colorHexa=u;s.asset=f;s.zIndex=e;s.priorityZIndex=o;c=!1;break}c&&this.customizations.push({categoryId:n,relatedCategoryId:t,subcategoryId:i?i:null,colorId:r?r:null,colorHexa:u?u:null,asset:f?f:null,zIndex:e?e:0,priorityZIndex:o?o:null})},getCustomization:function(n){for(var t=0;t<this.customizations.length;t++)if(this.customizations[t].categoryId==n)return this.customizations[t];return null},restoreCustomization:function(n,t){var i=this,r=i.getStorageItem(i.storageId),e,f,u;return r.customizations?(i.customizations=r.customizations,n(),!0):r.uuid?(e=i.config.api+"/api/customs_characters/"+r.uuid,u=[],this.$http.get(e).then(function(t){var p,r,a,e;for(p in t.data.custom)if(r=t.data.custom[p],r.assets){var v=null,h=null,l=null,w=null,b=null,k=null,s=null,o=null,y=null,c=!1;_.forEach(i.characterCategoriesAssets.groups,function(n){return r.id==n.id&&_.forEach(n.assets.subcategories,function(t){return(r.category_id==t.parent_id||!0)&&(r.icon||_.forEach(t.assets.colors,function(i){return i.id==r.assets.id?(v=n,b=r.id,s=t.id,o=i.assets.id,y=i.assets.hexa,c=!0,w=n,h=t,l=i,!1):c?!1:void 0})),c?!1:void 0}),c?!1:void 0});c||_.forEach(i.characterCategoriesAssets.categories,function(n){n.id==r.id&&(b=r.id,v=n,n.depends_category?(k=n.depends_category,r.assets.icon?(s=r.assets.id,_.forEach(n.assets.categories,function(n){_.forEach(n.assets.subcategories,function(n){n.id==s&&(h=n)})})):_.forEach(n.assets.categories,function(n){return _.forEach(n.assets.subcategories,function(n){return s=n.id,_.forEach(n.assets.colors,function(t){return t.id==r.assets.id?(o=t.assets.id,y=t.assets.hexa,h=n,l=t,!1):o?!1:void 0}),o?!1:void 0}),o?!1:void 0})):r.assets.icon?(s=r.assets.id,_.forEach(n.assets.subcategories,function(n){n.id==s&&(h=n)})):_.forEach(n.assets.subcategories,function(n){return s=n.id,_.forEach(n.assets.colors,function(t){return t.id==r.assets.id?(o=t.assets.id,y=t.assets.hexa,h=n,l=t,!1):o?!1:void 0}),o?!1:void 0}))});u.push({categoryToAdd:v,subcategoryToAdd:h,colorToAdd:l,groupToAdd:w})}for(a=0;a<u.length;a++)e=u[a],e.categoryToAdd&&i.selectCategory(e.categoryToAdd),e.groupToAdd&&i.selectGroup(e.groupToAdd),e.subcategoryToAdd&&i.selectSubCategory(e.subcategoryToAdd),e.colorToAdd&&i.selectColor(e.colorToAdd);n();f=!0},function(){console.log("Show some error to the user in the interface");f=!1;t();n()}),f):(t(),n(),!1)},updateCustomization:function(n,t,i,r,u){var f=this.getCustomization(n)||{};return t&&f.subcategoryId!=t&&(f.subcategoryId=t),i!=undefined&&(f.colorId=i),r!=undefined&&(f.colorHexa=r),u!=undefined&&(f.asset=u),f},updateRelatedCustomization:function(n){var t=this;_.forEach(t.customizations,function(i){i.relatedCategoryId==n.categoryId&&i.subcategoryId&&_.forEach(t.characterCategoriesAssets.categories,function(t){if(t.id==i.categoryId)return _.forEach(t.assets.categories,function(t){if(t.parent_id==n.subcategoryId)return _.forEach(t.assets.subcategories,function(n){var t,r,u;if(n.id==i.subcategoryId)return n.assets.colors.length>0?_.forEach(n.assets.colors,function(n){if(i.colorId==n.id)return t=n.assets.asset,r=n.id,u=n.hexa,!1}):t=n.assets.asset,i.colorId=r,i.colorHexa=u,i.asset=t,!1}),!1}),!1})})},isSelectedCategory:function(n){return this.selectedCategory&&n.id==this.selectedCategory.id},isSelectedGroup:function(n){return this.selectedGroup&&n.id==this.selectedGroup.id},isSelectedSubCategory:function(n){var t=this,i=!1,r;return t.selectedCategory?(r=t.getCustomization(t.selectedCategory.id),i=r&&r.subcategoryId==n.id):_.forEach(t.selectedGroup.groupedCategories,function(r){var u=t.getCustomization(r);if(u&&u.subcategoryId==n.id)return i=!0,!1}),i},isSelectedColor:function(n){var t=this,i=!1,r;return t.selectedCategory?(r=t.getCustomization(t.selectedCategory.id),i=r&&r.colorId==n.id):_.forEach(t.selectedGroup.groupedCategories,function(r){var u=t.getCustomization(r);if(u&&u.colorId==n.id)return i=!0,!1}),i},onScrollCategories:function(n){var t=this;(t.isAnimatingCategory||t.categoriesScrollTimeout||t.isDraggingCategories)&&clearTimeout(t.categoriesScrollTimeout);t.categoriesScrollTimeout=setTimeout(t.clickMiddleCategory,50,n.currentTarget)},resetAnimation:function(){function n(n){n&&(n.style.opacity=0,n.style.animation="none",setTimeout(()=>{n.style.animation="",n.style.opacity=1},100))}var t=document.getElementById("subcategories"),i=document.getElementById("color-options");n(t);n(i);t=document.getElementById("subcategories-mobile");i=document.getElementById("color-options-mobile");n(t);n(i)},getWindowWidth:function(){this.windowWidth=document.documentElement.clientWidth},getWindowHeight:function(){this.windowHeight=document.documentElement.clientHeight},nextIntro:function(){this.intro.current==this.intro.last?this.closeIntro():this.intro.current!=null&&(this.intro.current++,this.intro.current==this.intro.last&&setTimeout(this.closeIntro,3e3))},closeIntro:function(){this.updateStorageItem("checkAvatarIntro",!0,!0);this.intro.current=null},getCharacterPreviewHeightMobile:function(){var n=document.getElementById("customizationOptionsMobile");return n?document.documentElement.clientHeight-document.getElementById("personalizationMenu").offsetHeight-n.offsetHeight:""}},computed:{avatarClass:function(){return this.characterConfiguration&&this.characterConfiguration.type?"char-"+this.characterConfiguration.type.id:""},getTransitionKey:function(){return this.selectedCategory?this.selectedCategory.id:this.selectedGroup?this.selectedGroup.id:0},getValidateCategories:function(){var n=this,t=[];return _.forEach(n.characterCategoriesAssets.categories,function(i){var u,r;if(i.required){for(u in n.disableList)for(r=0;r<n.disableList[u].length;r++)if(n.disableList[u][r]===i.id)return;t.push({id:i.id,name:i.name})}}),_.remove(t,function(t){var i=!1;return _.forEach(n.customizations,function(n){if(n.categoryId==t.id&&n.subcategoryId)return i=!0,!1}),i}),t},lenghtVisibleCategories:function(){return(this.characterCategoriesAssets.categories?this.characterCategoriesAssets.categories.length:0)+(this.characterCategoriesAssets.groups?this.characterCategoriesAssets.groups.length:0)},showColorsOptions:function(){return this.selectedSubCategory!=null&&this.selectedSubCategory.assets.colors.length>0},characterConfiguration:function(){return this.characterCategoriesAssets},getSelectedSubCategories:function(){var n=this.selectedGroup?this.selectedGroup:this.selectedCategory,i,t;if(n.depends_category)for(i=this.getCustomization(n.depends_category),t=0;t<n.assets.categories.length;t++)if(n.assets.categories[t].parent_id==i.subcategoryId)return n.assets.categories[t].assets.subcategories;return n.assets.subcategories},isOpenColorPanel:function(){if(!this.selectedCategory)return!1;var n=this.getCustomization(this.selectedCategory.id);return n&&n.colorId}},created:function(){this.config=window.config;this.init()},mounted:function(){this.$nextTick(function(){window.addEventListener("resize",this.getWindowWidth);window.addEventListener("resize",this.getWindowHeight);this.getWindowWidth();this.getWindowHeight();var n=this.getStorageItem(this.storageId);n&&n.step2&&(this.step2=n.step2)})},beforeDestroy:function(){window.removeEventListener("resize",this.getWindowWidth);window.removeEventListener("resize",this.getWindowHeight)}});